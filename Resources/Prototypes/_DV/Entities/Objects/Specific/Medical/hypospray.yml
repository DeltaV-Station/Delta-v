- type: entity
  id: CombatHypospray
  name: combat hypospray
  parent: [BaseItem, BaseRestrictedContraband]
  description: A small hypospray intended for combat and rapid response teams, uses pre-built cartridges
  components:
    - type: Sprite
      sprite: _DV/Objects/Specific/Medical/combathypo.rsi
      state: hypo
    - type: Item
      sprite: _DV/Objects/Specific/Medical/combathypo.rsi
    - type: SolutionContainerManager
      solutions:
        hypospray:
          maxVol: 30 # Keep in sync with BaseEmptyHypoCartridge
          reagents: []
    - type: ExaminableSolution
      solution: hypospray
    - type: Hypospray
      solutionName: hypospray
      transferAmount: 30 # Whole cartridge goes in
      onlyAffectsMobs: false
      injectOnly: true
    - type: HyposprayBlockNonMobInjection
    - type: UseDelay
      delay: 0.5
    - type: SolutionCartridgeReceiver
      cartridgeSlot:
        whitelist:
          tags:
            - HyposprayCartridge
    - type: ContainerContainer
      containers:
        cartridge-slot: !type:ContainerSlot {}

- type: entity
  id: BaseEmptyHypoCartridge
  name: cartridge
  parent: [BaseItem, BaseRestrictedContraband]
  components:
    - type: Damageable
      damageContainer: Inorganic
      damageModifierSet: Glass
    - type: Destructible
      thresholds:
        - trigger: !type:DamageTrigger
            damage: 5
          behaviors:
            - !type:PlaySoundBehavior
              sound:
                collection: GlassBreak
                params:
                  volume: -4
            - !type:SpillBehavior
              solution: cartridge
            - !type:SpawnEntitiesBehavior
              spawn:
                ShardGlass:
                  min: 1
                  max: 1
              transferForensics: true
            - !type:DoActsBehavior
              acts: ["Destruction"]
    - type: DamageOnLand
      damage:
        types:
          Blunt: 10 # glass resistance set reduces damage. Need to land twice (w/o hitting wall)
    - type: DamageOtherOnHit
      damage:
        types:
          Blunt: 5
    - type: DamageOnHighSpeedImpact
      minimumSpeed: 2
      damage:
        types:
          Blunt: 5
    - type: SolutionContainerManager
      solutions:
        cartridge:
          maxVol: 30 # Keep in sync with the CombatHypospray
          reagents: []
    - type: Tag
      tags:
        - HyposprayCartridge
    - type: Drink # So we can view how much is IN the cartridge
      solution: cartridge
    - type: BlockDrinking # So we can stop people drinking the cartridge
    - type: Sprite
      sprite: Objects/Specific/Chemistry/bottle.rsi
      layers:
        - state: bottle-1
        - state: bottle-1-1
          map: ["enum.SolutionContainerLayers.Fill"]
          visible: false
    - type: ExaminableSolution
      solution: cartridge
    - type: SolutionItemStatus
      solution: cartridge
    - type: SolutionContainerVisuals
      maxFillLevels: 6
      fillBaseName: bottle-1-
    - type: Item
      size: Small
      sprite: Objects/Specific/Chemistry/bottle.rsi
