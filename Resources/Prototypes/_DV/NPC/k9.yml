- type: htnCompound
  id: k9Compound
  branches:
    - preconditions:
        - !type:HasOrdersPrecondition
          orders: enum.RemoteControlOrderType.EntityPoint
      tasks:
        - !type:HTNPrimitiveTask
          operator: !type:K9TargetInfoOperator
        - !type:HTNCompoundTask
          task: K9GrappleCompound
    - preconditions:
        - !type:HasOrdersPrecondition
          orders: enum.RemoteControlOrderType.TilePoint
      tasks:
        - !type:HTNPrimitiveTask
          operator: !type:DropCatchOrderOperator
        - !type:HTNPrimitiveTask
          operator: !type:MoveToOperator
            pathfindInPlanning: true
            targetKey: MovementTarget
            rangeKey: IdleRange
        - !type:HTNCompoundTask
          task: IdleSpinCompound
    - preconditions:
        - !type:HasOrdersPrecondition
          orders: enum.RemoteControlOrderType.SelfPoint
      tasks:
        - !type:HTNPrimitiveTask
          operator: !type:DropCatchOrderOperator
        - !type:HTNCompoundTask
          task: FollowCompound
    - preconditions:
        - !type:HasOrdersPrecondition
          orders: enum.RemoteControlOrderType.FreeUnit
      tasks:
        - !type:HTNPrimitiveTask
          operator: !type:DropCatchOrderOperator
        - !type:HTNCompoundTask
          task: SimpleHostileCompound

- type: htnCompound
  id: K9GrappleCompound
  branches:
    - preconditions: # If it's a mob that we can grapple...
        - !type:KeyBoolEqualsPrecondition
          key: HasGrappleTarget
          value: true
        - !type:KeyBoolEqualsPrecondition
          key: HasMobTarget
          value: true
      tasks:
        - !type:HTNPrimitiveTask
          operator: !type:MoveToOperator
            shutdownState: PlanFinished
            pathfindInPlanning: true
            removeKeyOnFinish: false
            targetKey: TargetCoordinates
            pathfindKey: TargetPathfind
            rangeKey: MeleeRange
        - !type:HTNPrimitiveTask
          operator: !type:CatchOrderOperator
    - preconditions: # If it's a mob that we can't grapple...
        - !type:KeyBoolEqualsPrecondition
          key: HasGrappleTarget
          value: false
        - !type:KeyBoolEqualsPrecondition
          key: HasMobTarget
          value: true
      tasks:
        - !type:HTNPrimitiveTask
          operator: !type:UtilityOperator
            proto: OrderedTargets
        - !type:HTNCompoundTask
          task: MeleeAttackOrderedTargetCompound
    - preconditions: # If it's not a mob at all...
        - !type:KeyBoolEqualsPrecondition
          key: HasGrappleTarget
          value: false
        - !type:KeyBoolEqualsPrecondition
          key: HasMobTarget
          value: false
      tasks:
        - !type:HTNPrimitiveTask
          operator: !type:MoveToOperator
            pathfindInPlanning: true
            targetKey: TargetCoordinates
            rangeKey: IdleRange
        - !type:HTNCompoundTask
          task: IdleSpinCompound
