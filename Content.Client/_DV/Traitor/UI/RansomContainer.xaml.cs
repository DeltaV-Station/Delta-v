using Content.Shared._DV.Traitor;
using Robust.Client.AutoGenerated;
using Robust.Client.UserInterface.Controls;
using Robust.Client.UserInterface.XAML;

namespace Content.Client._DV.Traitor.UI;

[GenerateTypedNameReferences]
public sealed partial class RansomContainer : BoxContainer
{
    public event Action<NetEntity>? OnPurchase;

    public RansomContainer()
    {
        RobustXamlLoader.Load(this);
    }

    public void UpdateRansoms(List<RansomData> ransoms, int balance)
    {
        Visible = ransoms.Count > 0;
        ListingsContainer.RemoveAllChildren();
        foreach (var ransom in ransoms)
        {
            var listing = new RansomListing(ransom);
            listing.UpdateBalance(balance);
            listing.OnPurchase += ent => OnPurchase?.Invoke(ent);
            ListingsContainer.AddChild(listing);
        }
    }

    public void UpdateBalance(int balance)
    {
        foreach (var control in ListingsContainer.Children)
        {
            if (control is RansomListing listing)
                listing.UpdateBalance(balance);
        }
    }
}
