using Content.Shared._DV.Traitor;
using Robust.Client.AutoGenerated;
using Robust.Client.UserInterface.Controls;
using Robust.Client.UserInterface.XAML;

namespace Content.Client._DV.Traitor.UI;

[GenerateTypedNameReferences]
public sealed partial class RansomContainer : BoxContainer
{
    public event Action<NetEntity>? OnPurchase;

    private List<RansomListing> _listings = new();

    public RansomContainer()
    {
        RobustXamlLoader.Load(this);
    }

    public void UpdateRansoms(List<RansomData> ransoms)
    {
        Visible = ransoms.Count > 0;
        ListingsContainer.RemoveAllChildren();
        _listings.Clear();
        foreach (var ransom in ransoms)
        {
            var listing = new RansomListing(ransom);
            listing.OnPurchase += ent => OnPurchase?.Invoke(ent);
            _listings.Add(listing);
            ListingsContainer.AddChild(listing);
        }
    }

    public void UpdateBalance(int balance)
    {
        foreach (var listing in _listings)
        {
            listing.UpdateBalance(balance);
        }
    }
}
