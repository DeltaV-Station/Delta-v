using Content.Client.Message;
using Content.Shared._Impstation.CosmicCult.Prototypes;
using Robust.Client.AutoGenerated;
using Robust.Client.GameObjects;
using Robust.Client.UserInterface.Controls;
using Robust.Client.UserInterface.XAML;

namespace Content.Client._Impstation.CosmicCult.UI.Monument;
[GenerateTypedNameReferences]
public sealed partial class InfluenceUIBox : BoxContainer
{
    [Dependency] private readonly IEntityManager _entityManager = default!;

    private readonly SpriteSystem _sprite;

    public Action? OnGainButtonPressed;

    public InfluenceUIBox(InfluencePrototype influenceProto, bool enabled)
    {
        RobustXamlLoader.Load(this);
        IoCManager.InjectDependencies(this);
        _sprite = _entityManager.System<SpriteSystem>();
        GainButton.StyleClasses.Add("ButtonColorPurpleAndCool");

        InfluenceIcon.Texture = _sprite.Frame0(influenceProto.Icon);
        Name.Text = Loc.GetString(influenceProto.Name);

        // Special coloring and names if its locked vs unlocked.
        if (enabled)
        {
            Status.Text = Loc.GetString("monument-interface-influences-unlocked");
            GainButton.Disabled = false;
        }
        else
        {
            Status.Text = Loc.GetString("monument-interface-influences-locked");
            Status.FontColorOverride = Color.White;
            GainButton.Disabled = true;
            GainButton.Modulate = Color.Gray;
            Name.FontColorOverride = Color.White;
            InfluenceBox.Modulate = Color.Gray;
            InfluenceIcon.Modulate = Color.Gray;
            Description.Modulate = Color.Gray;
            Type.Modulate = Color.Gray;
            CostText.Modulate = Color.Gray;
            Cost.FontColorOverride = Color.Gray;
        }

        Type.Text = Loc.GetString(influenceProto.InfluenceType);
        Cost.Text = influenceProto.Cost.ToString();
        Description.SetMarkup(Loc.GetString(influenceProto.Description));

        GainButton.OnPressed += _ => OnGainButtonPressed?.Invoke();
    }
}
